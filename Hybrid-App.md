# Hybrid App技术解析

## 引言

随着Web技术和移动设备的快速发展，Hybrid技术已经成为一种主流方案。一套好的 Hybrid 架构方案能让 App 既能拥有系统级别的能力，优秀的体验，也能拥有 Web技术 灵活的开发模式、跨平台能力以及热更新，想想是不是都激动不已。。😄。本文是公司在这方面实践的一个总结，包含原理解析与实践经验。

## 现有混合方案

现在比较流行的混合方案大概有三种，主要是在UI渲染机制上的不同:

1. 基于Webview UI的基础方案，市面上大部分主流App都有采用，例如微信JSSDK，通过JSBridge完成H5与Native的通讯，从而赋予H5一定程度的原生能力。

2. 基于Native UI的方案，例如React-Native、Weex。在赋予H5原生API能力的基础上，进一步通过JSBridge将js生成的虚拟DOM传递到Native并使用原生渲染。

3. 另外还有近期比较流行的小程序方案，也是通过更加定制化的JSBridge，并使用双webview双线程的模式隔离了JS逻辑与UI渲染，形成了特殊的开发模式，加强了 H5 与 Native 混合程度，提高了页面性能及开发体验；

出于公司现有情况的几点考虑:

- 需求 Web技术 快速迭代、灵活开发的特点和线上热更新的机制。
- 产品的核心能力是强大的拍照与底层图片处理能力，因此单纯的H5技术能做的事非常有限，不能满足需求，而通过Hybrid技术来强化H5，便是一种必需。
- 公司业务上，并不会对UI的性能有什么特别高的要求，而且App中的一系列原生UI组件已经非常成熟。

因此，如何既能利用H5强大的开发和迭代能力，又能赋予H5强大的底层能力，同时能复用现有的成熟 Native组件，便成为了我们最大的需求点 -- 一套完整又强大的 Hybrid技术架构方案。

## Hybrid技术原理

Hybrid技术 其实可以算一种跨语言方案，因此最核心的点，其实就是 Native端 与 H5端 的通讯层，建立一套最基础的、完整的双向通讯机制，便是首要任务。

交互，意味着双向通讯机制，其实便是 Native(java/objective-c/...) 与 javascript 的通讯。Hybrid App的本质，其实是在原生的App客户端中，使用 webview 做为容器直接承载 Web。因此，实现这个通讯层的关键，便是作为容器的 webview；

### 1. Javascript 通知 Native

基于 webview 的机制和开放的Api, 实现这个功能有三种常见的方案：

- API注入，原理其实就是 Native 获取 Javascript环境上下文，并直接在上面挂载对象或者方法，使 js 可以直接调用。Android 与 IOS 分别拥有对应的挂载方式。

- 



